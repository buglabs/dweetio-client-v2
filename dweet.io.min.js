!function(){function t(t){return"[object Array]"===Object.prototype.toString.call(t)}var e=!0;try{e=require}catch(n){e=!1}var io,o,i,r="last-thing.dat",c="https://beta.dweet.io:443",l=!0,s=5e3;if(e){if(io=require("socket.io-client"),o=require("request"),require("fs").existsSync(r))try{i=require("fs").readFileSync(r).toString()}catch(n){}}else o=function(t,e){var n=new XMLHttpRequest;n.open(t.method||"GET",t.url),Object.keys(t.headers).forEach(function(e){n.setRequestHeader(e,t.headers[e])}),n.send(JSON.stringify(t.json)),n.onreadystatechange=function(){var t=4,o=200;n.readyState===t&&(n.status===o?e(null,n.response,n.responseText):console.log("Error: "+n.status))}},function(){var t=/ded|co/,e="onload",n="onreadystatechange",o="readyState",i=function(i,r){var c=document.createElement("script");c[e]=c[n]=function(){(!this[o]||t.test(this[o]))&&(c[e]=c[n]=null,r&&r(c),c=null)},c.async=!0,c.src=i,document.body.appendChild(c)};window.dweet_script_loader=function(t,e){if("string"==typeof t)return void i(t,e);var n=t.shift();i(n,function(n){t.length?window.dweet_script_loader(t,e):e&&e(n)})}}();var u=function(n,u){function a(t){return t.created&&(t.created=new Date(t.created)),t}function f(t){if(t instanceof Array)for(var e=0;e<t.length;e++){var n=t[e];a(n)}else a(t);return t}function d(t){var e;try{e="string"==typeof t||t instanceof String?JSON.parse(t):t}catch(n){}return e}function g(t){var e,n=d(t);return n?"failed"==n["this"]&&(e=new Error(n.because)):e=new Error("server returned an invalid response"),e}function h(t,e,n){var o=d(n);t||(t=g(o)),o&&o["with"]?e&&e(t,f(o["with"])):o?e&&e(t,o):e&&e("no response from server",void 0)}function _(t){w.token?t():w.login(n,u,t)}function v(t,e){_(function(){var n={"X-DWEET-AUTH":w.token,Accept:"application/json","Content-Type":"application/json"};o({method:t.method||"GET",url:c+t.url,json:t.data,followAllRedirects:!0,timeout:s,strictSSL:l,jar:!0,headers:n},t.callback||function(t,n,o){h(t,e,o)})})}var p,w=this,k={},m=i;w.login=function(t,e,n){var i={"X-DWEET-AUTH":w.token,Accept:"application/json","Content-Type":"application/json"};o({method:"POST",url:c+"/v2/users/login",json:{username:t,password:e},followAllRedirects:!0,timeout:s,strictSSL:l,jar:!0,headers:i},function(t,e,o){t&&console.log(t),o&&(w.token=o.GROUP.token),h(t,n,o)})},w.set_server=function(t,n){c=t,l=n,e&&(n?require("https").globalAgent.options.rejectUnauthorized=!0:require("https").globalAgent.options.rejectUnauthorized=!1)},w.dweet=function(t,n){v({url:"/v2/dweets",data:t,method:"POST",callback:function(t,o,i){var c=d(i);c["with"]&&c["with"].thing!=m&&(m=c["with"].thing,e&&require("fs").writeFile(r,m)),h(t,n,c)}})},w.get_latest_dweet_for=function(t,e,n){"function"==typeof e&&(n=e,e=null),v({url:"/v2/dweets/latest?thing="+t+"&key="+e},n)},w.get_recent_dweets_for=function(t,e){v({url:"/v2/dweets?thing="+t},e)},w.get_dweets_for_past_hour_for=function(t,e){v({url:"/v2/dweets/hour?thing="+t},e)},w.get_all_dweets_for=function(t,e){v({url:"/v2/dweets/all?thing="+t},e)},w.get_dweets_in_range=function(t,e,n,o){v({url:"/v2/dweets/range?thing="+t+"&from="+e+"&to="+(n||Date.now())},o)},w.get_collection=function(t,e){v({url:"/v2/collections/recheck?name="+t},e)},w.get_collections=function(t){v({url:"/v2/collections/all"},t)},w.get_all_locks=function(t){v({url:"/v2/locks/all"},t)},w.get_locks_count=function(t){v({url:"/v2/locks/count"},t)},w.get_used_locks=function(t){v({url:"/v2/locks/used"},t)},w.get_unused_locks=function(t){v({url:"/v2/locks/unused"},t)},w.get_lock=function(t){v({url:"/v2/lock/one"},t)},w.lock=function(t,e,n){w.get_lock(function(o,i){v({url:"/v2/things/lock",method:"PUT",data:{name:t,lockId:i.id,collectionname:e}},n)})},w.unlock=function(t,e){v({url:"/v2/things/unlock",method:"PUT",data:{name:t}},e)},w.get_thing=function(t,e){v({url:"/v2/things?name="+t},e)},w.get_all_things=function(t){v({url:"/v2/things/all"},t)},w.get_things_in_collection=function(t,e){v({url:"/v2/things/collection?collection="+t},e)},w.get_count_in_collection=function(t,e){v({url:"/v2/things/count?collection="+t},e)},w.find_things_like=function(t,e){v({url:"/v2/things/find?like="+t},e)},w.search=function(t,e){v({url:"/v2/things/search-all?search="+t},e)},w.listen_for=function(t,n,o){function i(){p=io.connect(c+"/v2/stream"),_(function(){p.on("connect",function(){for(var t in k)p.emit("subscribe",{thing:t,key:n,token:w.token})})}),p.on("new_dweet",function(t){if(k[t.thing]){f(t);for(var e=k[t.thing],n=0;n<e.length;n++)e[n](t)}})}k[t]||(k[t]=[]),-1==k[t].indexOf(o)&&k[t].push(o),p||(e?i():dweet_script_loader([c+"/socket.io/socket.io.js"],function(){io=window.io,i()})),p&&p.emit("subscribe",{thing:t,key:n,token:w.token})},w.stop_listening=function(){k={},p&&(p.disconnect(),p=void 0)},w.stop_listening_for=function(t){k[t]=void 0,delete k[t],p&&p.emit("unsubscribe",{thing:t})},w.set_alert=function(e,n){t(e.recipients)||(e.recipients=[e.recipients]),v({url:"/v2/alerts",method:"POST",data:{thing:e.thing,name:e.name,recipients:e.recipients,condition:e.condition}},n)},w.get_alert=function(t,e){v({url:"/v2/alerts?thing="+t},e)},w.get_alert_in_range=function(t,e,n,o){v({url:"/v2/alerts/range?thing="+t+"&from="+e+"&to="+n},o)},w.get_all_alerts=function(t){v({url:"/v2/alerts/all"},t)},w.get_all_alerts_in_range=function(t,e,n){v({url:"/v2/alerts/range/all?from="+t+"&to="+e},n)},w.remove_alert=function(t,e,n){v({url:"/v2/alerts",method:"DELETE",data:{thing:t,name:e}},n)}};e?module.exports=u:window.dweetio=new u}();
//# sourceMappingURL=dweet.io.min.map